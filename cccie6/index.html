<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>

<title>Cookie Clicker</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<style>
body,html {
    padding:0;
    margin:0;
}
body {
    font-family:Courier New,monospace;
    background:#ccc;
    overflow-y:auto;
    /* Removed user-select and touch-callout properties (unsupported in IE6) */
}

/* Removed ::selection and ::-moz-selection (unsupported) */

#cookie {
    width:128px;
    height:128px;
    background:url(cookie.png);
    position:absolute;
    left:-64px;
    cursor:pointer;
}
#cookie:hover { background-position:-128px; }
#cookie:active { background-position:-256px; }
#cookie .cursor {
    width:32px;
    height:32px;
    position:absolute;
    background:url(cursor.png);
}

#pops {
    position:absolute;
    left:0;
    top:0;
    z-index:10000;
}

.pop {
    font-weight:bold;
    color:#fff;
    width:200px;
    height:20px;
    font-size:20px;
    text-align:center;
}

#rightPanel {
    position:absolute;
    right:0;
    top:0;
    z-index:100000;
}
#store {
    position:relative;
}
#store div {
    background:#eee no-repeat;
    width:256px;
    height:64px;
    padding-left:72px;
    cursor:pointer;
    border:#000 2px solid;
    position:relative;
}
#store div:hover { background-color:#fff; }
#store div:active { background-color:#ccc; }
#store div b { display:block; }
#store div.grayed {
    background-color:#666;
    color:#f00;
}

#store div .amount {
    position:absolute;
    right:8px;
    top:8px;
    font-size:48px;
    color:#000;
    filter:alpha(opacity=20); /* replaces opacity */
}

#money {
    background:url(currency.png) no-repeat;
    background-color:#fff;
    filter:alpha(opacity=75); /* replaces rgba */
    position:absolute;
    left:0;
    top:0;
    margin:16px;
    height:28px;
    padding:4px 4px 0 36px;
    font-weight:bold;
    font-size:24px;
    z-index:100;
}

#saveMenu {
    position:absolute;
    left:0;
    top:45px;
    margin:10px 16px;
    padding:2px 6px;
    font-weight:bold;
    font-size:12px;
    background:#fff;
    filter:alpha(opacity=75);
    line-height:125%;
    z-index:100;
}
#saveMenu .button {
    text-decoration:underline;
    cursor:pointer;
    font-size:14px;
}

#updateLog {
    position:absolute; /* replaces fixed */
    left:0;
    bottom:20px;
    margin:16px;
    padding:6px;
    font-weight:bold;
    font-size:12px;
    color:#666;
    background:#fff;
    filter:alpha(opacity=75);
    line-height:125%;
    width:250px;
    height:300px;
    overflow-y:auto;
    z-index:100;
}
#updateLog b { color:#000; }

moni {
    background:url(currencysmall.png) no-repeat;
    width:16px;
    height:16px;
    display:inline-block;
    position:relative;
    top:4px;
    margin-right:-8px;
}

#comment {
    position:absolute;
    left:-200px;
    top:-115px;
    width:400px;
    font-weight:bold;
    font-size:16px;
    text-align:center;
    background-color:#fff;
    filter:alpha(opacity=75);
}

#credits {
    width:100%;
    height:20px;
    background:#666;
    color:#fff;
    position:absolute; /* replaces fixed */
    bottom:0;
    margin:0;
    font-size:12px;
    border-top:2px solid #999;
    z-index:100000;
}
#credits span { margin:4px; }
a { color:#fff; }

#alert {
    background-color:#666;
    color:#fff;
    border:2px solid #000;
    position:absolute; /* replaces fixed */
    right:0;
    bottom:0;
    padding:8px;
    z-index:20000000;
    visibility:hidden;
    font-size:14px;
}

#tip {
    position:absolute; /* replaces fixed */
    left:0;
    bottom:20px;
    width:100%;
    height:20px;
}
</style>

</head>
<body id="whole">

<div id="hiddenLoader" style="display:none;"></div>

<div id="credits" style="position:absolute;bottom:0;">
  <span>
    <b>Cookie Clicker</b> &copy;
    <a href="http://orteil.dashnet.org">Orteil</a>, 2013 - hosted by
    <a href="http://dashnet.org">DashNet</a> |
    check out my <a href="http://twitter.com/orteil42">twitter</a> and
    <a href="http://orteil42.tumblr.com">tumblr</a> |
    also : <a href="http://orteil.dashnet.org/nested">Nested</a> |
    the big update is
    <a href="http://orteil.dashnet.org/cookieclicker/" target="_blank">out</a>!
  </span>
</div>

<div id="game">
  <div id="log"></div>

  <div id="updateLog" style="position:absolute;">
    <b>06/09/2013</b><br>
    <b>0.126</b><br>
    -technical fixes<br>
    -better servers!<br>
    <div style="background:#666;color:#fff;padding:4px 0;">
      <b style="color:#fff;">
        24/08/2013 : the big update is finally out!<br>
        <a href="http://orteil.dashnet.org/cookieclicker/" target="_blank">Check it out!</a>
      </b>
    </div>
    <b>0.125</b><br>
    -added a new object<br>
    -added option to disable flashing<br>
    -welp I'm going back to work<br>
    <b>0.124</b><br>
    -elder pledge is cheaper and now buffs grandmas and clicking while active<br>
    -page title now displays cookies<br>
    <b>0.123</b><br>
    -added cookies per second<br>
    -reworked grandmas<br>
    -still not the big update<br>
    <br>
    <b>13/08/2013</b> : this isn't the big update, just a couple features that have been requested often.<br>
    <b>0.122</b><br>
    -fixed background flashing<br>
    -added a new secret end-game item to counter the grandmapocalypse<br>
    <b>0.121</b><br>
    -import/export save<br>
    -ask confirm on reset<br>
    -speed tweaks<br>
  </div>

  <div id="money"></div>

  <div id="saveMenu">
    <div id="cps"></div>
    <div class="button" id="exportSave" onclick="exportSave();">Export save</div>
    <div class="button" id="importSave" onclick="importSave();">Import save</div>
    <div class="button" id="reset" onclick="Reset();">Reset</div>
    <br>
    <div class="button" id="toggleNumbers" onclick="ToggleNumbers();">Numbers On</div>
    <div class="button" id="toggleFlash" onclick="ToggleFlash();">Flashing On</div>
    <br>
    <div id="version"></div>
  </div>

  <div id="rightPanel">
    <div id="store"></div>
  </div>

  <div id="middle">
    <div id="grandmas"></div>
    <div id="factories"></div>
    <div id="mines"></div>
    <div id="shipments"></div>
    <div id="labs"></div>
    <div id="portals"></div>
    <div id="times"></div>
    <div id="comment">Loading...</div>
    <div id="cookie" onmouseup="ClickCookie();" onmouseover="HoverCookie();"></div>
  </div>

  <div id="pops"></div>
</div>

<div id="alert"></div>
<script type="text/javascript">
// --- helpers ---
function eventFire(el, etype){
  if (el && el.fireEvent) {
    el.fireEvent('on' + etype);
  } else if (el) {
    // Standards path (not used by IE6)
    var evObj = document.createEvent ? document.createEvent('Events') : null;
    if (evObj) { evObj.initEvent(etype, true, false); el.dispatchEvent(evObj); }
  }
}
function l(id){ return document.getElementById(id); }

// IE6-safe: get the visual center of an element in viewport coords
function getCenter(el){
  var x=0, y=0, n=el;
  while (n) { x += n.offsetLeft || 0; y += n.offsetTop || 0; n = n.offsetParent; }
  var w = el.offsetWidth || 0, h = el.offsetHeight || 0;
  var doc = document.documentElement, body = document.body;
  var scrollLeft = (doc && doc.scrollLeft) ? doc.scrollLeft : (body ? body.scrollLeft : 0);
  var scrollTop  = (doc && doc.scrollTop)  ? doc.scrollTop  : (body ? body.scrollTop  : 0);
  return { x:(x - scrollLeft) + Math.floor(w/2), y:(y - scrollTop) + Math.floor(h/2) };
}

// Simulate position:fixed for IE6
function UpdateFixed(){
  var doc = document.documentElement, body = document.body;
  var scrollTop = (doc && doc.scrollTop) ? doc.scrollTop : (body ? body.scrollTop : 0);
  var clientH = (doc && doc.clientHeight) ? doc.clientHeight : (body ? body.clientHeight : 0);

  var credits = l('credits');
  if (credits) credits.style.top = (scrollTop + clientH - (credits.offsetHeight||20)) + 'px';

  var updateLog = l('updateLog');
  if (updateLog) updateLog.style.top = (scrollTop + clientH - 20 - (updateLog.offsetHeight||300)) + 'px';

  var alertBox = l('alert');
  if (alertBox) alertBox.style.top = (scrollTop + clientH - (alertBox.offsetHeight||28)) + 'px';

  var tip = l('tip');
  if (tip) tip.style.top = (scrollTop + clientH - 20 - (tip.offsetHeight||20)) + 'px';
}

// --- boot ---
Game = l('game');
Version = 0.1251;
Loaded = 0;
if (l('version')) l('version').innerHTML = 'running v.' + Version;

// number formatting
function Beautify(what){
  var str='', i;
  what = Math.floor(what);
  what = (what+'').split('').reverse();
  for (i=0;i<what.length;i++){
    if (i%3==0 && i>0) str=','+str;
    str=what[i]+str;
  }
  return str;
}

// Preload local assets (avoid HTTPS on IE6)
(function(){
  var pics=['cursor','grandma','mine','factory','lab','shipment','goldengrandma','grandmaiconinvert','grandmaiconlustful','portal','skellington','kaleigrandma','factorygrandma','minegrandma','shipmentgrandma','portalgrandma','pledgedgrandma','pledgeicon','timemachine','timegrandma'];
  var s='', i;
  for (i=0;i<pics.length;i++) s += '<img src="'+pics[i]+'.png" />';
  if (l('hiddenLoader')) l('hiddenLoader').innerHTML = s;
})();

// --- state ---
Cookies=0; CookiesDisplay=0; Clicking=0; Hovering=0; T=0;
Cursors=0; Grandmas=0; Factories=0; Mines=0; Shipments=0; Labs=0; Portals=0; Times=0;
Pledge=0;
NumbersOn=1; Flashing=1;
StoreToRebuild=0;

// --- UI toggles ---
function ToggleNumbers(){ if (NumbersOn){NumbersOn=0;l('toggleNumbers').innerHTML='Numbers Off';} else {NumbersOn=1;l('toggleNumbers').innerHTML='Numbers On';} }
function ToggleFlash(){ if (Flashing){Flashing=0;l('toggleFlash').innerHTML='Flashing Off';} else {Flashing=1;l('toggleFlash').innerHTML='Flashing On';} }

// --- save/import/export ---
importSave=function(){
  var save=prompt('Please paste in the text that was given to you on save export.','');
  if (save && save!='') ImportResponse('1|'+save);
  Save();
};
exportSave=function(){
  var save=prompt('Copypaste this text and keep it somewhere safe! (yes, it\'s easy to edit - but remember : cheated cookies taste terrible!)',MakeSaveString());
};

ImportResponse=function(response){
  var r=response.split('|');
  if (response!='0' && response){
    if (r[0]=='1'){
      Cookies=parseInt(r[2],10);
      Pledge=0;
      Cursors=Math.min(1000,parseInt(r[3],10));Buyables['Cursor'].price=parseInt(r[4],10);
      Grandmas=Math.min(1000,parseInt(r[5],10));Buyables['Grandma'].price=parseInt(r[6],10);
      Factories=Math.min(1000,parseInt(r[7],10));Buyables['Factory'].price=parseInt(r[8],10);
      Mines=Math.min(1000,parseInt(r[9],10));Buyables['Mine'].price=parseInt(r[10],10);
      Shipments=Math.min(1000,parseInt(r[11],10));Buyables['Shipment'].price=parseInt(r[12],10);
      Labs=Math.min(1000,parseInt(r[13],10));Buyables['Alchemy lab'].price=parseInt(r[14],10);
      if (r[15]) {Portals=Math.min(1000,parseInt(r[15],10));Buyables['Portal'].price=parseInt(r[16],10);}
      if (r[17]) {Times=Math.min(1000,parseInt(r[17],10));Buyables['Time machine'].price=parseInt(r[18],10);}
      Buyables['Grandma'].func(0);
      Buyables['Factory'].func(0);
      Buyables['Mine'].func(0);
      Buyables['Shipment'].func(0);
      Buyables['Alchemy lab'].func(0);
      Buyables['Portal'].func(0);
      Buyables['Time machine'].func(0);
      StoreToRebuild=1;
    }
  }
  new Pop('credits','Imported.');
};

Reset=function(){
  if (confirm('Do you REALLY want to start over?')){
    document.cookie='CookieClickerSave=0; expires=Fri, 3 Aug 2001 20:47:11 UTC;';
    ResetResponse();
  }
};
ResetResponse=function(){ location.reload(true); };

MakeSaveString=function(){
  var str='';
  str+=Version+'|'+parseInt(Cookies,10)+'|'+
  parseInt(Cursors,10)+'|'+parseInt(Buyables['Cursor'].price,10)+'|'+
  parseInt(Grandmas,10)+'|'+parseInt(Buyables['Grandma'].price,10)+'|'+
  parseInt(Factories,10)+'|'+parseInt(Buyables['Factory'].price,10)+'|'+
  parseInt(Mines,10)+'|'+parseInt(Buyables['Mine'].price,10)+'|'+
  parseInt(Shipments,10)+'|'+parseInt(Buyables['Shipment'].price,10)+'|'+
  parseInt(Labs,10)+'|'+parseInt(Buyables['Alchemy lab'].price,10)+'|'+
  parseInt(Portals,10)+'|'+parseInt(Buyables['Portal'].price,10)+'|'+
  parseInt(Times,10)+'|'+parseInt(Buyables['Time machine'].price,10);
  return str;
};

SaveTimer=30*60;
Save=function(){
  var str=MakeSaveString();
  var now=new Date();
  now.setFullYear(now.getFullYear()+5);
  str='CookieClickerSave='+escape(str)+'; expires='+now.toUTCString()+';';
  document.cookie=str;
  if (document.cookie.indexOf('CookieClickerSave')<0) Pop('credits','<span style="color:#f00;">Error while saving.<br>Export your save instead!</span>');
  else Pop('credits','Saved');
  SaveTimer=30*60;
};

Load=function(){
  var s='0', all=document.cookie;
  if (all && all.indexOf('CookieClickerSave')>=0){
    // IE6 cookie string is a single line "k=v; k2=v2"; simplest split:
    var part=all.split('CookieClickerSave=')[1] || '';
    part=part.split(';')[0] || '';
    s='1|'+unescape(part);
  }
  LoadResponse(s);
  if (l('updateLog')) l('updateLog').style.overflow='auto'; // IE6 doesn't support overflow-y
  if (l('comment')) l('comment').innerHTML='Loading cookie...';
};

LoadResponse=function(response){
  var r=response.split('|');
  if (response!='0' && response){
    if (r[0]=='1'){
      Cookies=parseInt(r[2],10);
      Pledge=0;
      Cursors=Math.min(1000,parseInt(r[3],10));Buyables['Cursor'].price=parseInt(r[4],10);
      Grandmas=Math.min(1000,parseInt(r[5],10));Buyables['Grandma'].price=parseInt(r[6],10);
      Factories=Math.min(1000,parseInt(r[7],10));Buyables['Factory'].price=parseInt(r[8],10);
      Mines=Math.min(1000,parseInt(r[9],10));Buyables['Mine'].price=parseInt(r[10],10);
      Shipments=Math.min(1000,parseInt(r[11],10));Buyables['Shipment'].price=parseInt(r[12],10);
      Labs=Math.min(1000,parseInt(r[13],10));Buyables['Alchemy lab'].price=parseInt(r[14],10);
      if (r[15]) {Portals=Math.min(1000,parseInt(r[15],10));Buyables['Portal'].price=parseInt(r[16],10);}
      if (r[17]) {Times=Math.min(1000,parseInt(r[17],10));Buyables['Time machine'].price=parseInt(r[18],10);}
      Buyables['Grandma'].func(0);
      Buyables['Factory'].func(0);
      Buyables['Mine'].func(0);
      Buyables['Shipment'].func(0);
      Buyables['Alchemy lab'].func(0);
      Buyables['Portal'].func(0);
      Buyables['Time machine'].func(0);
      StoreToRebuild=1;
    }
  }
  // Prevent pop overlays from stealing clicks in IE6
  if (l('cookie')) l('cookie').style.zIndex = 1000;
  if (l('pops')) l('pops').style.zIndex = 50;

  new Pop('credits','Loaded.');
  Loaded=1;

  // hook pseudo-fixed handlers
  if (window.attachEvent){
    window.attachEvent('onscroll', UpdateFixed);
    window.attachEvent('onresize', UpdateFixed);
  } else {
    window.onscroll = UpdateFixed;
    window.onresize = UpdateFixed;
  }

  Main();
};

// --- game actions ---
ClickCookie=function(){
  var howmany=(Pledge>0?Math.ceil(Cursors*1.5):1);
  Cookies+=howmany;
  if (Pops.length<260 && NumbersOn) new Pop('cookie','+'+howmany);
  Clicking=1;
};
HoverCookie=function(){ Hovering=1; };
AddCookie=function(howmany,el){
  Cookies+=howmany;
  if (el && Pops.length<250 && NumbersOn) new Pop(el,'+'+howmany);
};

// --- store ---
RebuildStore=function(){
  var i, str='', amount=0, b;
  for (i in Buyables){
    b = Buyables[i];
    amount=0;
    if (b.name=='Cursor') amount=Cursors;
    else if (b.name=='Grandma') amount=Grandmas;
    else if (b.name=='Factory') amount=Factories;
    else if (b.name=='Mine') amount=Mines;
    else if (b.name=='Shipment') amount=Shipments;
    else if (b.name=='Alchemy lab') amount=Labs;
    else if (b.name=='Portal') amount=Portals;
    else if (b.name=='Time machine') amount=Times;
    str+='<div id="buy'+b.name+'" onclick="Buy(\''+b.name+'\');" style="'+
      (b.name=='Elder Pledge'?'display:none;':'')+
      (b.name=='Time machine'?'font-size:90%;':'')+
      'background-image:url('+b.pic+'.png);"><b>'+b.name+' - <moni></moni> '+Beautify(b.price)+'</b>'+b.desc+''+
      (amount>0?('<div class="amount">'+amount+'</div>'):'')+'</div>';
  }
  l('store').innerHTML=str;
  StoreToRebuild=0;
};

Buyables=[];
Buyable=function(name,desc,pic,price,func){
  this.name=name; this.desc=desc; this.pic=pic; this.price=price; this.func=func;
  Buyables[name]=this;
  this.Buy=function(){
    if (Cookies>=this.price && Loaded){
      Cookies-=this.price;
      this.price=Math.ceil(this.price*1.1);
      this.func(1);
      StoreToRebuild=1;
    }
  };
  StoreToRebuild=1;
};
Buy=function(what){ Buyables[what].Buy(); };

new Buyable('Cursor','Autoclicks every 5 seconds.','cursoricon',15,function(){Cursors++;});
new Buyable('Grandma','A nice grandma to bake more cookies.','grandmaicon',100,function(buy){
  if (buy) Grandmas++;
  var i,x,y,cl,str='';
  for (i=0;i<Grandmas;i++){
    x=Math.floor(Math.random()*20+(i%10)*24);
    y=Math.floor(Math.random()*20+Math.floor(i/10)*24);
    cl=0;
    if (Labs && Math.random()<0.2) cl='goldengrandma';
    if (Factories && Math.random()<0.2) cl='factorygrandma';
    if (Mines && Math.random()<0.2) cl='minegrandma';
    if (Shipments && Math.random()<0.2) cl='shipmentgrandma';
    if (Portals && Pledge<=0 && Math.random()<0.2) cl='portalgrandma';
    if (Times && Math.random()<0.2) cl='timegrandma';
    if (Pledge && Math.random()<0.2) cl='pledgedgrandma';
    str+='<div class="'+(cl?cl+' ':'')+'grandma" style="left:'+x+'px;top:'+y+'px;"></div>';
  }
  l('grandmas').innerHTML=str;
});
new Buyable('Factory','Produces large quantities of cookies.','factoryicon',500,function(buy){
  if (buy) Factories++;
  if (buy && Factories==1) Buyables['Grandma'].func();
  var i,x,y,str='';
  for (i=0;i<Factories;i++){
    x=Math.floor(Math.random()*20+(i%10)*32);
    y=Math.floor(Math.random()*20+Math.floor(i/10)*24);
        str+='<div class="factory" style="right:'+x+'px;top:'+y+'px;"></div>';
  }
  l('factories').innerHTML=str;
});
new Buyable('Mine','Mines out cookie dough and chocolate chips.','mineicon',2000,function(buy){
  if (buy) Mines++;
  if (buy && Mines==1) Buyables['Grandma'].func();
  var i,x,y,str='';
  for (i=0;i<Mines;i++){
    x=Math.floor(Math.random()*20+(i%10)*16);
    y=Math.floor(Math.random()*20+Math.floor(i/10)*16);
    str+='<div class="mine" style="left:'+x+'px;top:'+y+'px;"></div>';
  }
  l('mines').innerHTML=str;
});
new Buyable('Shipment','Brings in fresh cookies from the cookie planet.','shipmenticon',7000,function(buy){
  if (buy) Shipments++;
  if (buy && Shipments==1) Buyables['Grandma'].func();
  var i,x,y,str='';
  for (i=0;i<Shipments;i++){
    x=Math.floor(Math.random()*20+(i%10)*24);
    y=Math.floor(Math.random()*20+Math.floor(i/10)*24);
    str+='<div class="shipment" style="right:'+x+'px;top:'+y+'px;"></div>';
  }
  l('shipments').innerHTML=str;
});
new Buyable('Alchemy lab','Turns gold into cookies!','labicon',50000,function(buy){
  if (buy) Labs++;
  if (buy && Labs==1) Buyables['Grandma'].func();
  var i,x,y,str='';
  for (i=0;i<Labs;i++){
    x=Math.floor(Math.random()*20+(i%10)*24);
    y=Math.floor(Math.random()*20+Math.floor(i/10)*16);
    str+='<div class="lab" style="right:'+x+'px;top:'+y+'px;"></div>';
  }
  l('labs').innerHTML=str;
});
new Buyable('Portal','Opens a door to the Cookieverse.','portalicon',1000000,function(buy){
  if (buy) Portals++;
  if (buy && Portals==1) Buyables['Grandma'].func();
  var i,x,y,str='';
  for (i=0;i<Portals;i++){
    x=Math.floor(Math.random()*20+(i%10)*24);
    y=Math.floor(Math.random()*20+Math.floor(i/10)*24);
    str+='<div class="portal" style="right:'+x+'px;top:'+y+'px;"></div>';
  }
  l('portals').innerHTML=str;
});
new Buyable('Time machine','<span style="font-size:80%;">Brings cookies from the past, before they were even eaten.</span>','timemachineicon',123456789,function(buy){
  if (buy) Times++;
  if (buy && Times==1) Buyables['Grandma'].func();
  var i,x,y,str='';
  for (i=0;i<Times;i++){
    x=Math.floor(Math.random()*20+(i%10)*24);
    y=Math.floor(Math.random()*20+Math.floor(i/10)*24);
    str+='<div class="time" style="right:'+x+'px;top:'+y+'px;"></div>';
  }
  l('times').innerHTML=str;
});

new Buyable('Elder Pledge','<span style="font-size:80%;">Puts an end to the Ancients\' wrath, at least for a while.</span>','pledgeicon',666666,function(buy){
  if (buy) {Pledge*=2;Pledge+=30*60*10;}
  if (buy) Buyables['Grandma'].func();
  var ep=l('buyElder Pledge'); if (ep) ep.style.display='none';
});

// --- pops ---
Pops=[];
Pop=function(el,str){
  this.el=el;
  this.str=str;
  this.life=0;
  this.offx=Math.floor(Math.random()*20-10);
  this.offy=Math.floor(Math.random()*20-10);
  Pops.push(this);
};

// --- main loop ---
Main=function(){
  var i,str='';

  // simulate fixed elements each frame for IE6
  UpdateFixed();

  if (StoreToRebuild){
    RebuildStore();
    StoreToRebuild=0;
  }

  // floating numbers
  str='';
  for (i=0;i<Pops.length;i++){
    var center=getCenter(l(Pops[i].el));
    var x=Math.floor(center.x + Pops[i].offx)-100;
    var y=Math.floor(center.y - Math.pow(Pops[i].life/100,0.5)*100 + Pops[i].offy)-10;
    var opacity=1-(Math.max(Pops[i].life,80)-80)/20;
    var o=Math.max(0,Math.min(100,Math.round(opacity*100)));
    str+='<div class="pop" style="position:absolute;left:'+x+'px;top:'+y+'px;filter:alpha(opacity='+o+');">'+Pops[i].str+'</div>';
    Pops[i].life+=2;
    if (Pops[i].life>=100){ Pops.splice(i,1); i--; }
  }
  l('pops').innerHTML=str;

  // cursors around cookie (no CSS transforms in IE6)
  str='';
  if (Cursors>0){
    for (i=0;i<Cursors;i++){
      var xC=Math.floor(64+Math.sin((Math.PI*2/Cursors)*i)*64)-16;
      var yC=Math.floor(64+Math.cos((Math.PI*2/Cursors)*i)*64)-16;
      if ((T)%150==Math.ceil((150/Cursors)*i)) yC+=2;
      str+='<div class="cursor" style="left:'+xC+'px;top:'+yC+'px;"></div>';
    }
  }
  l('cookie').innerHTML=str;

  // production
  var grandmaGain=Math.ceil(4+(Factories?1:0)+(Mines?2:0)+(Shipments?3:0)+(Labs?4:0)+(Portals?(Pledge?5+Portals*0.5:5):0)+(Times?6:0));
  var cursorGain=(Pledge>0?Math.ceil(Cursors*1.5):1);

  if (Times && T%Math.ceil(150/Times)==0) AddCookie(123456,'times');
  if (Portals && T%Math.ceil(150/Portals)==0) AddCookie(6666,'portals');
  if (Labs && T%Math.ceil(150/Labs)==0) AddCookie(500,'labs');
  if (Shipments && T%Math.ceil(150/Shipments)==0) AddCookie(100,'shipments');
  if (Mines && T%Math.ceil(150/Mines)==0) AddCookie(50,'mines');
  if (Factories && T%Math.ceil(150/Factories)==0) AddCookie(20,'factories');
  if (Grandmas && T%Math.ceil(150/Grandmas)==0) AddCookie(grandmaGain,'grandmas');
  if (Cursors && T%Math.ceil(150/Cursors)==0) eventFire(l('cookie'),'mouseup');

  // cps
  var cps=0;
  cps+=Times*123456/5;
  cps+=Portals*6666/5;
  cps+=Labs*500/5;
  cps+=Shipments*100/5;
  cps+=Mines*50/5;
  cps+=Factories*20/5;
  cps+=Grandmas*grandmaGain/5;
  cps+=Cursors*cursorGain/5;

  var floater=Math.round(cps*10-Math.floor(cps)*10);
  var cpsStr=Beautify(cps)+(floater?('.'+floater):'');
  l('cps').innerHTML='cookies/second : '+cpsStr;

  // store affordance
  for (i in Buyables){
    var el=l('buy'+Buyables[i].name);
    if (!el) continue;
    el.className=(Cookies>=Buyables[i].price)?'':'grayed';
  }

  // money counter
  CookiesDisplay+=(Cookies-CookiesDisplay)*0.5;
  l('money').innerHTML=Beautify(Math.round(CookiesDisplay));

  // status text
  str='';
  if (Cookies<5) str='You feel like making cookies.<br>But nobody wants to eat your cookies.';
  else if (Cookies<25) str='Your cookies are popular<br>with your dog.';
  else if (Cookies<50) str='Your cookies are popular<br>with your family.';
  else if (Cookies<100) str='Your cookies are popular<br>in the neighborhood.';
  else if (Cookies<500) str='Your cookies are renowned<br>in the whole town!';
  else if (Cookies<2000) str='Your cookies are worth<br>a lot of money.';
  else if (Cookies<5000) str='Your cookies bring<br>all the boys to the yard.';
  else if (Cookies<10000) str='People come from very far away<br>to get a taste of your cookies.';
  else if (Cookies<17000) str='Kings and queens from all over the world<br>are enjoying your cookies.';
  else if (Cookies<30000) str='Your cookies have been named<br>a part of the world wonders.';
  else if (Cookies<60000) str='Your cookies have been placed<br>under government surveillance.';
  else if (Cookies<100000) str='The whole planet is<br>enjoying your cookies!';
  else if (Cookies<150000) str='Creatures from neighboring planets<br>wish to try your cookies.';
  else if (Cookies<250000) str='Elder gods from the whole cosmos<br>have awoken to taste your cookies.';
  else if (Cookies<400000) str='Your cookies have achieved sentience.';
  else if (Cookies<1000000) str='The universe has now turned into<br>cookie dough, to the molecular level.';
  else if (Cookies<1000000000) str='A local news station runs<br>a 10-minute segment about your cookies. Success!<br><span style="font-size:50%;">(you win a cookie)</span>';
  else str='it\'s time to stop playing<br><span style="font-size:50%;">(more fun milestones in the next update I promise)</span>';
  l('comment').innerHTML=str;

  // pledge timer
  if (Pledge>0) Pledge--;

  // background flashing (no backgroundSize in IE6)
  if (Cookies>=1000000 && Pledge<=0 && Flashing){
    var r=(Cookies-1000000)/2000000;
    var icon='grandmaicon';
    if (Cookies>=2000000){
      var ep=l('buyElder Pledge'); if (ep) ep.style.display='block';
      if (Math.random()<0.02) icon='grandmaiconinvert';
      else if (Math.random()<0.02) icon='grandmaiconlustful';
    }
    if (Cookies>=10000000 && Math.random()<0.02) icon='skellington';
    if (Cookies>=1000000000){
      l('whole').style.background='url(kaleigrandma.png) '+Math.floor(T*0.2)+'px -'+Math.floor(T*0.1)+'px';
    } else if (Math.random()<r){
      l('whole').style.background='url('+icon+'.png) '+Math.floor(Math.random()*4)+'px '+Math.floor(Math.random()*4)+'px';
    }
  } else {
    l('whole').style.background='#ccc';
  }

  if (T%30==0 && Loaded) document.title=Beautify(Cookies)+' cookies - Cookie Clicker';
  Clicking=0;
  Hovering=0;

  SaveTimer--;
  if (SaveTimer==0 && Loaded) Save();

  T++;
  setTimeout(Main,50); // ~20fps for IE6
};

// kick off
Load();
</script>
</body>
</html>